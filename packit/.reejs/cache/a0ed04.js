import{default as Z}from"./00bea4.js";var D=0;function l(){return(D=(D+1)%Number.MAX_SAFE_INTEGER).toString()}var Q=class extends Error{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AuthenticationError"})}},V=class extends Error{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PermissionError"})}},Y=class extends Error{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RecordError"})}},U={AuthenticationError:Q,PermissionError:V,RecordError:Y},w=function(e,t,r,i){if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?i:r==="a"?i.call(e):i?i.value:t.get(e)},f,N=class{constructor(){f.set(this,{})}on(e,t){typeof w(this,f,"f")[e]!="object"&&(w(this,f,"f")[e]=[]),w(this,f,"f")[e].push(t)}off(e,t){if(typeof w(this,f,"f")[e]=="object"){let r=w(this,f,"f")[e].indexOf(t);r>-1&&w(this,f,"f")[e].splice(r,1)}}once(e,t){this.on(e,function r(...i){this.off(e,r),t.apply(this,i)})}emit(e,...t){typeof w(this,f,"f")[e]=="object"&&w(this,f,"f")[e].forEach(r=>{r.apply(this,t)})}removeAllListeners(e){if(e)typeof w(this,f,"f")[e]=="object"&&(w(this,f,"f")[e]=[]);else for(let t in w(this,f,"f"))w(this,f,"f")[t]=[]}};f=new WeakMap;var T=function(e,t,r,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r},m=function(e,t,r,i){if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?i:r==="a"?i.call(e):i?i.value:t.get(e)},p,v,W,M,J=class extends N{constructor(e,t,r){super(),p.set(this,void 0),v.set(this,void 0),W.set(this,void 0),M.set(this,void 0),T(this,v,e,"f"),T(this,W,t,"f"),T(this,M,r,"f"),m(this,v,"f").ready&&this.open(),m(this,v,"f").on("opened",()=>{this.open()}),m(this,v,"f").on("closed",()=>{T(this,p,void 0,"f")}),m(this,v,"f").on("notify",i=>{if(i.query===m(this,p,"f"))switch(i.action){case"CREATE":return this.emit("create",i.result);case"UPDATE":return this.emit("update",i.result);case"DELETE":return this.emit("delete",i.result)}})}kill(){if(m(this,p,"f")===void 0)return;let e=m(this,v,"f").kill(m(this,p,"f"));return T(this,p,void 0,"f"),e}open(){if(m(this,p,"f")===void 0)return m(this,v,"f").query(m(this,W,"f"),m(this,M,"f")).then(e=>{e[0]&&Array.isArray(e[0].result)&&e[0].result[0]&&T(this,p,e[0].result[0],"f")})}};p=new WeakMap,v=new WeakMap,W=new WeakMap,M=new WeakMap;var c=function(e,t,r,i){if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?i:r==="a"?i.call(e):i?i.value:t.get(e)},k=function(e,t,r,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r},L,u,C,S,A,$,_=Symbol("Opened"),F=Symbol("Closed"),ee=class extends N{constructor(e){super(),L.add(this),u.set(this,void 0),C.set(this,void 0),S.set(this,!1),A.set(this,F),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resolve",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),c(this,L,"m",$).call(this),k(this,C,String(e).replace("http://","ws://").replace("https://","wss://"),"f")}open(){k(this,u,new Z(c(this,C,"f")),"f"),c(this,u,"f").addEventListener("message",e=>{this.emit("message",e)}),c(this,u,"f").addEventListener("error",e=>{this.emit("error",e)}),c(this,u,"f").addEventListener("close",e=>{this.emit("close",e)}),c(this,u,"f").addEventListener("open",e=>{this.emit("open",e)}),c(this,u,"f").addEventListener("close",()=>{c(this,A,"f")===_&&c(this,L,"m",$).call(this)}),c(this,u,"f").addEventListener("close",()=>{k(this,A,F,"f")}),c(this,u,"f").addEventListener("open",()=>{k(this,A,_,"f")}),c(this,u,"f").addEventListener("close",()=>{c(this,S,"f")===!1&&setTimeout(()=>{this.open()},2500)}),c(this,u,"f").addEventListener("open",()=>{this.resolve()})}send(e){c(this,u,"f").send(e)}close(e=1e3,t="Some reason"){k(this,S,!0,"f"),c(this,u,"f").close(e,t)}};u=new WeakMap,C=new WeakMap,S=new WeakMap,A=new WeakMap,L=new WeakSet,$=function(){this.ready=new Promise(e=>{this.resolve=e})};var G=function(e,t,r,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r},X=function(e,t,r,i){if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?i:r==="a"?i.call(e):i?i.value:t.get(e)},O,x,te=class{constructor(e=3e4){O.set(this,void 0),x.set(this,void 0),G(this,x,e,"f")}start(e,...t){G(this,O,setInterval(e,X(this,x,"f"),...t),"f")}stop(){clearInterval(X(this,O,"f"))}};O=new WeakMap,x=new WeakMap;var g=function(e,t,r,i,s){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?s.call(e,r):s?s.value=r:t.set(e,r),r},n=function(e,t,r,i){if(r==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?i:r==="a"?i.call(e):i?i.value:t.get(e)},o,h,q,E,j,R,B,a,I,H,K,b,P,z,y=class extends N{constructor(e,t){super(),o.add(this),h.set(this,void 0),q.set(this,void 0),E.set(this,void 0),j.set(this,void 0),R.set(this,void 0),g(this,q,e,"f"),g(this,E,t,"f"),e&&this.connect(e)}static get Instance(){return z||(z=new y)}static get AuthenticationError(){return U.AuthenticationError}static get PermissionError(){return U.PermissionError}static get RecordError(){return U.RecordError}static get Live(){return J}get token(){return n(this,E,"f")}set token(e){g(this,E,e,"f")}connect(e){return g(this,h,new ee(e),"f"),g(this,j,new te(3e4),"f"),n(this,h,"f").on("open",()=>{n(this,o,"m",B).call(this)}),n(this,h,"f").on("open",()=>{this.emit("open"),this.emit("opened"),n(this,j,"f").start(()=>{this.ping()})}),n(this,h,"f").on("close",()=>{this.emit("close"),this.emit("closed"),n(this,j,"f").stop()}),n(this,h,"f").on("message",t=>{let r=JSON.parse(t.data);if(r.method!=="notify")return this.emit(r.id,r);if(r.method==="notify")return r.params.forEach(i=>{this.emit("notify",i)})}),n(this,h,"f").open(),this.wait()}sync(e,t){return new J(this,e,t)}wait(){return n(this,h,"f").ready.then(()=>n(this,R,"f"))}close(){n(this,h,"f").close()}ping(){let e=l();return n(this,h,"f").ready.then(()=>new Promise(()=>{n(this,o,"m",a).call(this,e,"ping")}))}use(e,t){let r=l();return n(this,h,"f").ready.then(()=>new Promise((i,s)=>{this.once(r,d=>n(this,o,"m",b).call(this,d,i,s)),n(this,o,"m",a).call(this,r,"use",[e,t])}))}info(){let e=l();return n(this,h,"f").ready.then(()=>new Promise((t,r)=>{this.once(e,i=>n(this,o,"m",b).call(this,i,t,r)),n(this,o,"m",a).call(this,e,"info")}))}signup(e){let t=l();return n(this,h,"f").ready.then(()=>new Promise((r,i)=>{this.once(t,s=>n(this,o,"m",K).call(this,s,r,i)),n(this,o,"m",a).call(this,t,"signup",[e])}))}signin(e){let t=l();return n(this,h,"f").ready.then(()=>new Promise((r,i)=>{this.once(t,s=>n(this,o,"m",H).call(this,s,r,i)),n(this,o,"m",a).call(this,t,"signin",[e])}))}invalidate(){let e=l();return n(this,h,"f").ready.then(()=>new Promise((t,r)=>{this.once(e,i=>n(this,o,"m",I).call(this,i,t,r)),n(this,o,"m",a).call(this,e,"invalidate")}))}authenticate(e){let t=l();return n(this,h,"f").ready.then(()=>new Promise((r,i)=>{this.once(t,s=>n(this,o,"m",I).call(this,s,r,i)),n(this,o,"m",a).call(this,t,"authenticate",[e])}))}live(e){let t=l();return this.wait().then(()=>new Promise((r,i)=>{this.once(t,s=>n(this,o,"m",b).call(this,s,r,i)),n(this,o,"m",a).call(this,t,"live",[e])}))}kill(e){let t=l();return this.wait().then(()=>new Promise((r,i)=>{this.once(t,s=>n(this,o,"m",b).call(this,s,r,i)),n(this,o,"m",a).call(this,t,"kill",[e])}))}let(e,t){let r=l();return this.wait().then(()=>new Promise((i,s)=>{this.once(r,d=>n(this,o,"m",b).call(this,d,i,s)),n(this,o,"m",a).call(this,r,"let",[e,t])}))}query(e,t){let r=l();return this.wait().then(()=>new Promise((i,s)=>{this.once(r,d=>n(this,o,"m",b).call(this,d,i,s)),n(this,o,"m",a).call(this,r,"query",[e,t])}))}select(e){let t=l();return this.wait().then(()=>new Promise((r,i)=>{this.once(t,s=>n(this,o,"m",P).call(this,s,"select",e,r,i)),n(this,o,"m",a).call(this,t,"select",[e])}))}create(e,t){let r=l();return this.wait().then(()=>new Promise((i,s)=>{this.once(r,d=>n(this,o,"m",P).call(this,d,"create",e,i,s)),n(this,o,"m",a).call(this,r,"create",[e,t])}))}update(e,t){let r=l();return this.wait().then(()=>new Promise((i,s)=>{this.once(r,d=>n(this,o,"m",P).call(this,d,"update",e,i,s)),n(this,o,"m",a).call(this,r,"update",[e,t])}))}change(e,t){let r=l();return this.wait().then(()=>new Promise((i,s)=>{this.once(r,d=>n(this,o,"m",P).call(this,d,"change",e,i,s)),n(this,o,"m",a).call(this,r,"change",[e,t])}))}modify(e,t){let r=l();return this.wait().then(()=>new Promise((i,s)=>{this.once(r,d=>n(this,o,"m",P).call(this,d,"modify",e,i,s)),n(this,o,"m",a).call(this,r,"modify",[e,t])}))}delete(e){let t=l();return this.wait().then(()=>new Promise((r,i)=>{this.once(t,s=>n(this,o,"m",P).call(this,s,"delete",e,r,i)),n(this,o,"m",a).call(this,t,"delete",[e])}))}};h=new WeakMap,q=new WeakMap,E=new WeakMap,j=new WeakMap,R=new WeakMap,o=new WeakSet,B=function(){g(this,R,new Promise(e=>{n(this,E,"f")?this.authenticate(n(this,E,"f")).then(e).catch(e):e()}),"f")},a=function(e,t,r=[]){n(this,h,"f").send(JSON.stringify({id:e,method:t,params:r}))},I=function(e,t,r){return e.error?r(new y.AuthenticationError(e.error.message)):t(e.result)},H=function(e,t,r){return e.error?r(new y.AuthenticationError(e.error.message)):(g(this,E,e.result,"f"),t(e.result))},K=function(e,t,r){if(e.error)return r(new y.AuthenticationError(e.error.message));if(e.result)return g(this,E,e.result,"f"),t(e.result)},b=function(e,t,r){return e.error?r(new Error(e.error.message)):e.result?t(e.result):t(void 0)},P=function(e,t,r,i,s){if(e.error)return s(new Error(e.error.message));if(e.result)switch(t){case"delete":return i(void 0);case"create":return Array.isArray(e.result)&&e.result.length?i(e.result[0]):s(new y.PermissionError(`Unable to create record: ${r}`));case"update":return typeof r=="string"&&r.includes(":")?Array.isArray(e.result)&&e.result.length?i(e.result[0]):s(new y.PermissionError(`Unable to update record: ${r}`)):i(e.result);case"change":return typeof r=="string"&&r.includes(":")?Array.isArray(e.result)&&e.result.length?i(e.result[0]):s(new y.PermissionError(`Unable to update record: ${r}`)):i(e.result);case"modify":return typeof r=="string"&&r.includes(":")?Array.isArray(e.result)&&e.result.length?i(e.result[0]):s(new y.PermissionError(`Unable to update record: ${r}`)):i(e.result);default:return typeof r=="string"&&r.includes(":")?Array.isArray(e.result)&&e.result.length?i(e.result):s(new y.RecordError(`Record not found: ${r}`)):i(e.result)}return i(void 0)};export{y as default};
//# sourceMappingURL=surrealdb.bundle.mjs.map