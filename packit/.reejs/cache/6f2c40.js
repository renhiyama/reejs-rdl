var T=(s=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(s,{get:(i,o)=>(typeof require<"u"?require:i)[o]}):s)(function(s){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+s+'" is not supported')});import W from"node:events";import Y from"node:zlib";import H from"node:https";var V=Object.create,A=Object.defineProperty,Z=Object.getOwnPropertyDescriptor,K=Object.getOwnPropertyNames,X=Object.getPrototypeOf,ee=Object.prototype.hasOwnProperty,pe=(s=>typeof T<"u"?T:typeof Proxy<"u"?new Proxy(s,{get:(i,o)=>(typeof T<"u"?T:i)[o]}):s)(function(s){if(typeof T<"u")return T.apply(this,arguments);throw new Error('Dynamic require of "'+s+'" is not supported')}),O=(s,i)=>()=>(i||s((i={exports:{}}).exports,i),i.exports),te=(s,i)=>{for(var o in i)A(s,o,{get:i[o],enumerable:!0})},U=(s,i,o,a)=>{if(i&&typeof i=="object"||typeof i=="function")for(let e of K(i))!ee.call(s,e)&&e!==o&&A(s,e,{get:()=>i[e],enumerable:!(a=Z(i,e))||a.enumerable});return s},re=(s,i,o)=>(U(s,i,"default"),o&&U(o,i,"default")),G=(s,i,o)=>(o=s!=null?V(X(s)):{},U(i||!s||!s.__esModule?A(o,"default",{value:s,enumerable:!0}):o,s)),L=O((s,i)=>{"use strict";var o=class extends Error{constructor(a,e,t,n){super(),Object.defineProperty(this,"req",{enumerable:!1,value:a,writable:!1}),Object.defineProperty(this,"res",{enumerable:!1,value:e,writable:!1}),Object.defineProperty(this,"response",{enumerable:!1,value:t,writable:!1}),Object.defineProperty(this,"code",{value:e.statusCode,writable:!1});let c=`${this.name}: ${e.statusCode} ${e.statusMessage} on ${a.method} ${a.path}`,v=this.flattenErrors(t);v.length>0&&(c+=`
  `+v.join(`
  `)),Object.defineProperty(this,"message",{value:c,writable:!1}),n?Object.defineProperty(this,"stack",{value:this.message+`
`+n,writable:!1}):Error.captureStackTrace(this,o)}get name(){return this.constructor.name}flattenErrors(a,e=""){let t=[];for(let n in a)!a.hasOwnProperty(n)||n==="message"||n==="code"||Array.isArray(a[n])&&(t=t.concat(a[n].map(c=>`${e+n}: ${c}`)));return t}};i.exports=o}),F=O((s,i)=>{"use strict";var o=class extends Error{constructor(a,e,t,n){super(),Object.defineProperty(this,"req",{enumerable:!1,value:a,writable:!1}),Object.defineProperty(this,"res",{enumerable:!1,value:e,writable:!1}),Object.defineProperty(this,"response",{enumerable:!1,value:t,writable:!1}),Object.defineProperty(this,"code",{value:+t.code||-1,writable:!1});let c=this.name+": "+(t.message||"Unknown error");if(t.errors)c+=`
  `+this.flattenErrors(t.errors).join(`
  `);else{let v=this.flattenErrors(t);v.length>0&&(c+=`
  `+v.join(`
  `))}Object.defineProperty(this,"message",{value:c,writable:!1}),n?Object.defineProperty(this,"stack",{value:this.message+`
`+n,writable:!1}):Error.captureStackTrace(this,o)}get name(){return`${this.constructor.name} [${this.code}]`}flattenErrors(a,e=""){let t=[];for(let n in a)!a.hasOwnProperty(n)||n==="message"||n==="code"||(a[n]._errors?t=t.concat(a[n]._errors.map(c=>`${e+n}: ${c.message}`)):Array.isArray(a[n])?t=t.concat(a[n].map(c=>`${e+n}: ${c}`)):typeof a[n]=="object"&&(t=t.concat(this.flattenErrors(a[n],e+n+"."))));return t}};i.exports=o}),ie=O((s,i)=>{"use strict";var o=class{constructor(a,e={latency:0}){this.limit=this.remaining=a,this.resetInterval=0,this.reset=0,this.processing=!1,this.latencyRef=e,this._queue=[]}queue(a,e){e?this._queue.unshift(a):this._queue.push(a),this.check()}check(a){if(this._queue.length===0){this.processing&&(clearTimeout(this.processing),this.processing=!1);return}if(this.processing&&!a)return;let e=Date.now(),t=this.latencyRef.latency+(this.latencyRef.offset||0);if(this.reset?this.reset<e-t&&(this.reset=e-t+(this.resetInterval||0),this.remaining=this.limit):(this.reset=e-t,this.remaining=this.limit),this.last=e,this.remaining<=0){this.processing=setTimeout(()=>{this.processing=!1,this.check(!0)},Math.max(0,(this.reset||0)-e)+t);return}--this.remaining,this.processing=!0,this._queue.shift()(()=>{this._queue.length>0?this.check(!0):this.processing=!1})}};i.exports=o}),se=O((s,i)=>{i.exports={name:"discord-oauth2",version:"2.11.0",description:"Easily interact with discord's oauth2 API",main:"index.js",scripts:{lint:"prettier-eslint ./**/*.js --list-different",fix:"prettier-eslint ./**/*.js --write"},repository:{type:"git",url:"git+https://github.com/reboxer/discord-oauth2.git"},keywords:["api","discord","discordapp","oauth2"],author:"reboxer",license:"MIT",bugs:{url:"https://github.com/reboxer/discord-oauth2/issues"},homepage:"https://github.com/reboxer/discord-oauth2#readme",devDependencies:{eslint:"^8.30.0","prettier-eslint-cli":"^7.1.0"}}}),ae=O((s,i)=>{"use strict";var o=L(),a=F(),e=H,t=ie(),n=Y,c=W,v=class extends c{constructor(h){super(),this.options=h=Object.assign({agent:null,baseURL:"/api/v9",domain:"discord.com",disableLatencyCompensation:!1,latencyThreshold:3e4,ratelimiterOffset:0,requestTimeout:15e3},h),this.userAgent=`Discord-OAuth2 (https://github.com/reboxer/discord-oauth2, ${se().version})`,this.ratelimits={},this.latencyRef={latency:this.options.ratelimiterOffset,raw:new Array(10).fill(this.options.ratelimiterOffset),timeOffset:0,timeOffsets:new Array(10).fill(0),lastTimeOffsetCheck:0},this.globalBlock=!1,this.readyQueue=[]}globalUnblock(){for(this.globalBlock=!1;this.readyQueue.length>0;)this.readyQueue.shift()()}routefy(h){return h.replace(/\/([a-z-]+)\/(?:[0-9]{17,19})/g,function(g,d){return d==="guilds"?g:`/${d}/:id`})}request(h,g,d,{auth:w,contentType:x,attempts:I=0},J,S){let l=J||this.routefy(g,h),B={};return Error.captureStackTrace(B),new Promise((j,b)=>{let D=$=>{let M={"User-Agent":this.userAgent,"Accept-Encoding":"gzip,deflate",...x?{"Content-Type":x}:{}},R;try{w&&(M.Authorization=`${w.type} ${w.creds}`),x==="application/json"?R=JSON.stringify(d,(r,q)=>typeof q=="bigint"?q.toString():q):R=d}catch(r){$(),b(r);return}let m;try{m=e.request({method:h,host:this.options.domain,path:this.options.baseURL+g,headers:M,agent:this.options.agent})}catch(r){$(),b(r);return}let f;m.once("abort",()=>{$(),f=f||new Error(`Request aborted by client on ${h} ${g}`),f.req=m,b(f)}).once("error",r=>{f=r,m.abort()});let k=Date.now();m.once("response",r=>{k=Date.now()-k,this.options.disableLatencyCompensation||(this.latencyRef.raw.push(k),this.latencyRef.latency=this.latencyRef.latency-~~(this.latencyRef.raw.shift()/10)+~~(k/10));let q=Date.parse(r.headers.date);if(this.latencyRef.lastTimeOffsetCheck<Date.now()-5e3){let u=q+500-(this.latencyRef.lastTimeOffsetCheck=Date.now());this.latencyRef.timeOffset-this.latencyRef.latency>=this.options.latencyThreshold&&u-this.latencyRef.latency>=this.options.latencyThreshold&&this.emit("warn",new Error(`Your clock is ${this.latencyRef.timeOffset}ms behind Discord's server clock. Please check your connection and system time.`)),this.latencyRef.timeOffset=this.latencyRef.timeOffset-~~(this.latencyRef.timeOffsets.shift()/10)+~~(u/10),this.latencyRef.timeOffsets.push(u)}r.once("aborted",()=>{$(),f=f||new Error(`Request aborted by server on ${h} ${g}`),f.req=m,b(f)});let p="",E=r;r.headers["content-encoding"]&&(r.headers["content-encoding"].includes("gzip")?E=r.pipe(n.createGunzip()):r.headers["content-encoding"].includes("deflate")&&(E=r.pipe(n.createInflate()))),E.on("data",u=>{p+=u}).on("error",u=>{f=u,m.abort()}).once("end",()=>{let u=Date.now();r.headers["x-ratelimit-limit"]&&(this.ratelimits[l].limit=+r.headers["x-ratelimit-limit"]),h!=="GET"&&(r.headers["x-ratelimit-remaining"]===void 0||r.headers["x-ratelimit-limit"]===void 0)&&this.ratelimits[l].limit!==1&&this.emit("debug",`Missing ratelimit headers for SequentialBucket(${this.ratelimits[l].remaining}/${this.ratelimits[l].limit}) with non-default limit
${r.statusCode} ${r.headers["content-type"]}: ${h} ${l} | ${r.headers["cf-ray"]}
content-type = 
x-ratelimit-remaining = `+r.headers["x-ratelimit-remaining"]+`
x-ratelimit-limit = `+r.headers["x-ratelimit-limit"]+`
x-ratelimit-reset = `+r.headers["x-ratelimit-reset"]+`
x-ratelimit-global = `+r.headers["x-ratelimit-global"]),this.ratelimits[l].remaining=r.headers["x-ratelimit-remaining"]===void 0?1:+r.headers["x-ratelimit-remaining"]||0;let _=parseInt(r.headers["x-ratelimit-reset-after"]||r.headers["retry-after"])*1e3;if(_>=0)r.headers["x-ratelimit-global"]?(this.globalBlock=!0,setTimeout(()=>this.globalUnblock(),_||1)):this.ratelimits[l].reset=(_||1)+u;else if(r.headers["x-ratelimit-reset"]){let y=+r.headers["x-ratelimit-reset"]*1e3;this.ratelimits[l].reset=Math.max(y-this.latencyRef.latency,u)}else this.ratelimits[l].reset=u;if(r.statusCode!==429){let y=typeof d=="object"?`${d.content} `:"";this.emit("debug",`${y}${u} ${l} ${r.statusCode}: ${k}ms (${this.latencyRef.latency}ms avg) | ${this.ratelimits[l].remaining}/${this.ratelimits[l].limit} left | Reset ${this.ratelimits[l].reset} (${this.ratelimits[l].reset-u}ms left)`)}if(r.statusCode>=300){if(r.statusCode===429){let C=typeof d=="object"?`${d.content} `:"";if(this.emit("debug",`${r.headers["x-ratelimit-global"]?"Global":"Unexpected"} 429 (\u256F\xB0\u25A1\xB0\uFF09\u256F\uFE35 \u253B\u2501\u253B: ${p}
${C} ${u} ${l} ${r.statusCode}: ${k}ms (${this.latencyRef.latency}ms avg) | ${this.ratelimits[l].remaining}/${this.ratelimits[l].limit} left | Reset ${this.ratelimits[l].reset} (${this.ratelimits[l].reset-u}ms left)`),_){setTimeout(()=>{$(),this.request(h,g,d,{auth:w,contentType:x},l,!0).then(j).catch(b)},_);return}else{$(),this.request(h,g,d,{auth:w,contentType:x},l,!0).then(j).catch(b);return}}else if(r.statusCode===502&&++I<4)return this.emit("debug","A wild 502 appeared! Thanks CloudFlare!"),setTimeout(()=>{this.request(h,g,d,{auth:w,contentType:x,attempts:I},l,!0).then(j).catch(b)},Math.floor(Math.random()*1900+100)),$();if($(),p.length>0&&r.headers["content-type"]==="application/json")try{p=JSON.parse(p)}catch(C){b(C);return}let{stack:y}=B;y.startsWith(`Error
`)&&(y=y.substring(6));let P;p.code?P=new a(m,r,p,y):P=new o(m,r,p,y),b(P);return}if(p.length>0&&r.headers["content-type"]==="application/json")try{p=JSON.parse(p)}catch(y){$(),b(y);return}$(),j(p)})}),m.setTimeout(this.options.requestTimeout,()=>{f=new Error(`Request timed out (>${this.options.requestTimeout}ms) on ${h} ${g}`),m.abort()}),m.end(R)};this.globalBlock&&w?this.readyQueue.push(()=>{this.ratelimits[l]||(this.ratelimits[l]=new t(1,this.latencyRef)),this.ratelimits[l].queue(D,S)}):(this.ratelimits[l]||(this.ratelimits[l]=new t(1,this.latencyRef)),this.ratelimits[l].queue(D,S))})}};i.exports=v}),ne=O((s,i)=>{"use strict";var o=ae(),a=class extends o{constructor(e={}){super({...e.agent?{agent:e.agent}:{},...e.requestTimeout?{requestTimeout:e.requestTimeout}:{},...e.latencyThreshold?{latencyThreshold:e.latencyThreshold}:{},...e.ratelimiterOffset?{ratelimiterOffset:e.ratelimiterOffset}:{},...e.disableLatencyCompensation?{disableLatencyCompensation:e.disableLatencyCompensation}:{}}),this.clientId=e.clientId,this.clientSecret=e.clientSecret,this.redirectUri=e.redirectUri,this.credentials=e.credentials}_encode(e){let t="";for(let[n,c]of Object.entries(e))c&&(t+=`&${encodeURIComponent(n)}=${encodeURIComponent(c)}`);return t.substring(1)}tokenRequest(e={}){let t={client_id:e.clientId||this.clientId,client_secret:e.clientSecret||this.clientSecret,grant_type:void 0,code:void 0,refresh_token:void 0,redirect_uri:e.redirectUri||this.redirectUri,scope:e.scope instanceof Array?e.scope.join(" "):e.scope};if(e.grantType==="authorization_code")t.code=e.code,t.grant_type=e.grantType;else if(e.grantType==="refresh_token")t.refresh_token=e.refreshToken,t.grant_type=e.grantType;else throw new Error("Invalid grant_type provided, it must be either authorization_code or refresh_token");let n=this._encode(t);return this.request("POST","/oauth2/token",n,{contentType:"application/x-www-form-urlencoded"})}revokeToken(e,t){if(!t&&!this.credentials)throw new Error("Missing credentials for revokeToken method");return this.request("POST","/oauth2/token/revoke",`token=${e}`,{auth:{type:"Basic",creds:t||this.credentials},contentType:"application/x-www-form-urlencoded"})}getUser(e){return this.request("GET","/users/@me",void 0,{auth:{type:"Bearer",creds:e}})}getUserGuilds(e){return this.request("GET","/users/@me/guilds",void 0,{auth:{type:"Bearer",creds:e}})}getUserConnections(e){return this.request("GET","/users/@me/connections",void 0,{auth:{type:"Bearer",creds:e}})}addMember(e){return this.request("PUT",`/guilds/${e.guildId}/members/${e.userId}`,{deaf:e.deaf,mute:e.mute,nick:e.nickname,roles:e.roles,access_token:e.accessToken},{auth:{type:"Bot",creds:e.botToken},contentType:"application/json"})}getGuildMember(e,t){return this.request("GET",`/users/@me/guilds/${t}/member`,void 0,{auth:{type:"Bearer",creds:e}})}generateAuthUrl(e={}){let t={client_id:e.clientId||this.clientId,prompt:e.prompt,redirect_uri:e.redirectUri||this.redirectUri,response_type:e.responseType||"code",scope:e.scope instanceof Array?e.scope.join(" "):e.scope,permissions:e.permissions,guild_id:e.guildId,disable_guild_select:e.disableGuildSelect,state:e.state};return`https://discord.com/oauth2/authorize?${this._encode(t)}`}};i.exports=a}),N=O((s,i)=>{"use strict";var o=ne();o.DiscordHTTPError=L(),o.DiscordRESTError=F(),i.exports=o}),Q={};te(Q,{default:()=>ce});var oe=G(N());re(Q,G(N()));var{default:z,...le}=oe,ce=z!==void 0?z:le;export{ce as default};
//# sourceMappingURL=discord-oauth2.bundle.mjs.map