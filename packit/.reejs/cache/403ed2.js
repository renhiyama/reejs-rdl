/* esm.sh - esbuild bundle(@remix-run/web-fetch@4.3.3) node production */
import Ke from"node:http";import Ye from"node:https";import k from"node:zlib";import Ze from"node:fs";import*as Re from"./99bebc.js";import Je from"./7c04cf.js";import j from"node:stream";import{types as He}from"node:util";import{Blob as N,ReadableStream as C}from"./068ad4.js";import{FormData as D}from"./2f3538.js";var T=class extends Error{constructor(e,r){super(e),Error.captureStackTrace(this,this.constructor),this.type=r}get name(){return this.constructor.name}get[Symbol.toStringTag](){return this.constructor.name}};var m=class extends T{constructor(e,r,o){super(e,r),o&&(this.code=this.errno=o.code,this.erroredSysCall=o.syscall)}};import{randomBytes as ze}from"node:crypto";import{iterateMultipart as Pe}from"./93c086.js";import Be from"node:stream";var H=Symbol.toStringTag,oe=t=>typeof t=="object"&&typeof t.append=="function"&&typeof t.delete=="function"&&typeof t.get=="function"&&typeof t.getAll=="function"&&typeof t.has=="function"&&typeof t.set=="function"&&typeof t.sort=="function"&&t[H]==="URLSearchParams",U=t=>typeof t=="object"&&typeof t.arrayBuffer=="function"&&typeof t.type=="string"&&typeof t.stream=="function"&&typeof t.constructor=="function"&&/^(Blob|File)$/.test(t[H]);function ne(t){return typeof t=="object"&&typeof t.append=="function"&&typeof t.set=="function"&&typeof t.get=="function"&&typeof t.getAll=="function"&&typeof t.delete=="function"&&typeof t.keys=="function"&&typeof t.values=="function"&&typeof t.entries=="function"&&typeof t.constructor=="function"&&t[H]==="FormData"}var se=t=>t instanceof Be&&typeof t.getBoundary=="function"&&typeof t.hasKnownLength=="function"&&typeof t.getLengthSync=="function",ae=t=>typeof t=="object"&&(t[H]==="AbortSignal"||t[H]==="EventTarget"),ie=t=>typeof t=="object"&&typeof t.getReader=="function"&&typeof t.cancel=="function"&&typeof t.tee=="function",ce=t=>t&&Symbol.iterator in t;var $=`\r
`,K="-".repeat(2),Ue=Buffer.byteLength($),le=t=>`${K}${t}${K}${$.repeat(2)}`;function ue(t,e,r){let o="";if(o+=`${K}${t}${$}`,o+=`Content-Disposition: form-data; name="${e}"`,U(r)){let{name:n="blob",type:i}=r;o+=`; filename="${n}"${$}`,o+=`Content-Type: ${i||"application/octet-stream"}`}return`${o}${$.repeat(2)}`}var fe=()=>ze(8).toString("hex");async function*he(t,e){let r=new TextEncoder;for(let[o,n]of t)yield r.encode(ue(e,o,n)),U(n)?yield*n.stream():yield r.encode(n),yield r.encode($);yield r.encode(le(e))}function de(t,e){let r=0;for(let[o,n]of t)r+=Buffer.byteLength(ue(e,o,n)),U(n)?r+=n.size:r+=Buffer.byteLength(String(n)),r+=Ue;return r+=Buffer.byteLength(le(e)),r}var pe=async t=>{let{body:e,headers:r}=t,o=r?.get("Content-Type")||"";if(o.startsWith("application/x-www-form-urlencoded")&&e!=null){let c=new D,s=await t.text();return new URLSearchParams(s).forEach((l,a)=>c.append(a,l)),c}let[n,i]=o.split(/\s*;\s*boundary=/);if(n==="multipart/form-data"&&i!=null&&e!=null){let c=new D,s=Pe(e,i);for await(let{name:l,data:a,filename:p,contentType:E}of s)p?c.append(l,new File([a],p,{type:E})):c.append(l,new TextDecoder().decode(a),p);return c}else throw new TypeError("Could not parse content as FormData.")};import{TextEncoder as $e,TextDecoder as Fe}from"node:util";var ke=new $e,ve=new Fe,Y=t=>ke.encode(t),me=t=>ve.decode(t);var{readableHighWaterMark:Oe}=new j.Readable,b=Symbol("Body internals"),x=class{constructor(e,{size:r=0}={}){let o={body:null,type:null,size:null,boundary:null,disturbed:!1,error:null};if(this[b]=o,e===null)o.body=null,o.size=0;else if(oe(e)){let n=Y(e.toString());o.body=O(n),o.size=n.byteLength,o.type="application/x-www-form-urlencoded;charset=UTF-8"}else if(U(e))o.size=e.size,o.type=e.type||null,o.body=e.stream();else if(e instanceof Uint8Array)o.body=O(e),o.size=e.byteLength;else if(He.isAnyArrayBuffer(e)){let n=new Uint8Array(e);o.body=O(n),o.size=n.byteLength}else if(ArrayBuffer.isView(e)){let n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);o.body=O(n),o.size=n.byteLength}else if(ie(e))o.body=e;else if(ne(e)){let n=`NodeFetchFormDataBoundary${fe()}`;o.type=`multipart/form-data; boundary=${n}`,o.size=de(e,n),o.body=F(he(e,n))}else if(se(e))o.type=`multipart/form-data; boundary=${e.getBoundary()}`,o.size=e.hasKnownLength()?e.getLengthSync():null,o.body=ye(e);else if(e instanceof j)o.body=ye(e);else{let n=Y(String(e));o.type="text/plain;charset=UTF-8",o.size=n.byteLength,o.body=O(n)}this.size=r}get headers(){throw new TypeError("'get headers' called on an object that does not implements interface.")}get body(){return this[b].body}get bodyUsed(){return this[b].disturbed}async arrayBuffer(){let{buffer:e,byteOffset:r,byteLength:o}=await Z(this);return e.slice(r,r+o)}async blob(){let e=this.headers&&this.headers.get("content-type")||this[b].body&&this[b].type||"",r=await Z(this);return new N([r],{type:e})}async json(){return JSON.parse(await this.text())}async text(){let e=await Z(this);return me(e)}async formData(){return pe(this)}};Object.defineProperties(x.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0},formData:{enumerable:!0}});async function Z(t){let e=t[b];if(e.disturbed)throw new TypeError(`body used already for: ${t.url}`);if(e.disturbed=!0,e.error)throw e.error;let{body:r}=e;if(r===null)return new Uint8Array(0);let[o,n,i]=t.size>0?[new Uint8Array(t.size),[],t.size]:[null,[],1/0],c=0,s=be(r);try{for await(let l of s){let a=l instanceof Uint8Array?l:Buffer.from(l);if(c+a.byteLength>i){let p=new m(`content size at ${t.url} over limit: ${i}`,"max-size");throw s.throw(p),p}else o?o.set(a,c):n.push(a);c+=a.byteLength}if(o){if(c<o.byteLength)throw new m(`Premature close of server response while trying to fetch ${t.url}`,"premature-close");return o}else return Ne(new Uint8Array(c),n)}catch(l){if(l instanceof T)throw l;if(l&&l.name==="AbortError")throw l;{let a=l;throw new m(`Invalid response body while trying to fetch ${t.url}: ${a.message}`,"system",a)}}}var M=t=>{let{body:e}=t;if(t.bodyUsed)throw new Error("cannot clone body after it is used");if(!e)return null;let[r,o]=e.tee();return t[b].body=r,o},I=t=>t[b].type,ge=t=>t[b].size,we=(t,{body:e})=>{e===null?t.end():j.Readable.from(be(e)).pipe(t)},J=class{constructor(e){this.stream=e,this.reader=null}[Symbol.asyncIterator](){return this}getReader(){if(this.reader)return this.reader;let e=this.stream.getReader();return this.reader=e,e}next(){return this.getReader().read()}async return(){return this.reader&&await this.reader.cancel(),{done:!0,value:void 0}}async throw(e){return await this.getReader().cancel(e),{done:!0,value:void 0}}},be=t=>new J(t),Ne=(t,e)=>{let r=0;for(let o of e)t.set(o,r),r+=o.byteLength;return t},O=t=>new C({start(e){e.enqueue(t),e.close()}}),F=t=>new C(new Q(t)),Q=class{constructor(e){this.source=e[Symbol.asyncIterator]()}async pull(e){try{for(;e.desiredSize||0>0;){let r=await this.source.next();if(r.done){e.close();break}else e.enqueue(r.value)}}catch(r){e.error(r)}}cancel(e){e?typeof this.source.throw=="function"?this.source.throw(e):typeof this.source.return=="function"&&this.source.return():typeof this.source.return=="function"&&this.source.return()}},ye=t=>{let e=new X(t);return new C(e,e)},X=class{constructor(e){this.highWaterMark=e.readableHighWaterMark||Oe,this.accumalatedSize=0,this.stream=e,this.enqueue=this.enqueue.bind(this),this.error=this.error.bind(this),this.close=this.close.bind(this)}size(e){return e?.byteLength||0}start(e){this.controller=e,this.stream.on("data",this.enqueue),this.stream.once("error",this.error),this.stream.once("end",this.close),this.stream.once("close",this.close)}pull(){this.resume()}cancel(e){this.stream.destroy&&this.stream.destroy(e),this.stream.off("data",this.enqueue),this.stream.off("error",this.error),this.stream.off("end",this.close),this.stream.off("close",this.close)}enqueue(e){if(this.controller)try{let r=e instanceof Uint8Array?e:Buffer.from(e),o=(this.controller.desiredSize||0)-r.byteLength;this.controller.enqueue(r),o<=0&&this.pause()}catch{this.controller.error(new Error("Could not create Buffer, chunk must be of type string or an instance of Buffer, ArrayBuffer, or Array or an Array-like Object")),this.cancel()}}pause(){this.stream.pause&&this.stream.pause()}resume(){this.stream.readable&&this.stream.resume&&this.stream.resume()}close(){this.controller&&(this.controller.close(),delete this.controller)}error(e){this.controller&&(this.controller.error(e),delete this.controller)}};import{types as Me}from"node:util";import Ie from"node:http";var W=Ie,q=typeof W.validateHeaderName=="function"?W.validateHeaderName:t=>{if(!/^[\^`\-\w!#$%&'*+.|~]+$/.test(t)){let e=new TypeError(`Header name must be a valid HTTP token [${t}]`);throw Object.defineProperty(e,"code",{value:"ERR_INVALID_HTTP_TOKEN"}),e}},ee=typeof W.validateHeaderValue=="function"?W.validateHeaderValue:(t,e)=>{if(/[^\t\u0020-\u007E\u0080-\u00FF]/.test(e)){let r=new TypeError(`Invalid character in header content ["${t}"]`);throw Object.defineProperty(r,"code",{value:"ERR_INVALID_CHAR"}),r}},d=class extends URLSearchParams{constructor(e){let r=[];if(e instanceof d){let o=e.raw();for(let[n,i]of Object.entries(o))r.push(...i.map(c=>[n,c]))}else if(e!=null)if(ce(e))r=[...e].map(o=>{if(typeof o!="object"||Me.isBoxedPrimitive(o))throw new TypeError("Each header pair must be an iterable object");return[...o]}).map(o=>{if(o.length!==2)throw new TypeError("Each header pair must be a name/value tuple");return[...o]});else if(typeof e=="object"&&e!==null)r.push(...Object.entries(e));else throw new TypeError("Failed to construct 'Headers': The provided value is not of type '(sequence<sequence<ByteString>> or record<ByteString, ByteString>)");return r=r.length>0?r.map(([o,n])=>(q(o),ee(o,String(n)),[String(o).toLowerCase(),String(n)])):[],super(r),new Proxy(this,{get(o,n,i){switch(n){case"append":case"set":return(c,s)=>(q(c),ee(c,String(s)),URLSearchParams.prototype[n].call(i,String(c).toLowerCase(),String(s)));case"delete":case"has":case"getAll":return c=>(q(c),URLSearchParams.prototype[n].call(i,String(c).toLowerCase()));case"keys":return()=>(o.sort(),new Set(URLSearchParams.prototype.keys.call(o)).keys());default:return Reflect.get(o,n,i)}}})}get[Symbol.toStringTag](){return this.constructor.name}toString(){return Object.prototype.toString.call(this)}get(e){let r=this.getAll(e);if(r.length===0)return null;let o=r.join(", ");return/^content-encoding$/i.test(e)&&(o=o.toLowerCase()),o}forEach(e,r=void 0){for(let o of this.keys())Reflect.apply(e,r,[this.get(o),o,this])}*values(){for(let e of this.keys())yield this.get(e)}*entries(){for(let e of this.keys())yield[e,this.get(e)]}[Symbol.iterator](){return this.entries()}raw(){return[...this.keys()].reduce((e,r)=>(e[r]=this.getAll(r),e),{})}[Symbol.for("nodejs.util.inspect.custom")](){return[...this.keys()].reduce((e,r)=>{let o=this.getAll(r);return r==="host"?e[r]=o[0]:e[r]=o.length>1?o:o[0],e},{})}};Object.defineProperties(d.prototype,["get","entries","forEach","values"].reduce((t,e)=>(t[e]={enumerable:!0},t),{}));function Se(t=[]){return new d(t.reduce((e,r,o,n)=>(o%2===0&&e.push(n.slice(o,o+2)),e),[]).filter(([e,r])=>{try{return q(e),ee(e,String(r)),!0}catch{return!1}}))}var qe=new Set([301,302,303,307,308]),_=t=>qe.has(t);var S=Symbol("Response internals"),h=class extends x{constructor(e=null,r={}){super(e,r);let o=r.status||200,n=new d(r.headers);if(e!==null&&!n.has("Content-Type")){let i=I(this);i&&n.append("Content-Type",i)}this[S]={url:r.url,status:o,statusText:r.statusText||"",headers:n,counter:r.counter||0,highWaterMark:r.highWaterMark}}get type(){return"default"}get url(){return this[S].url||""}get status(){return this[S].status}get ok(){return this[S].status>=200&&this[S].status<300}get redirected(){return this[S].counter>0}get statusText(){return this[S].statusText}get headers(){return this[S].headers}get highWaterMark(){return this[S].highWaterMark}clone(){return new h(M(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,size:this.size})}static redirect(e,r=302){if(!_(r))throw new RangeError('Failed to execute "redirect" on "response": Invalid status code');return new h(null,{headers:{location:new URL(e).toString()},status:r})}get[Symbol.toStringTag](){return"Response"}};Object.defineProperties(h.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}});import{format as We}from"node:url";import{AbortController as _e}from"./9c1c02.js";var Te=t=>{if(t.search)return t.search;let e=t.href.length-1,r=t.hash||(t.href[e]==="#"?"#":"");return t.href[e-r.length]==="?"?"?":""};var g=Symbol("Request internals"),Ve=new Set(["CONNECT","TRACE","TRACK"]),Ge=new Set(["DELETE","GET","HEAD","OPTIONS","POST","PUT"]),te=t=>typeof t=="object"&&typeof t[g]=="object",w=class extends x{constructor(e,r={}){let o,n;te(e)?(o=new URL(e.url),n=e):(o=new URL(e),n={});let i=r.method||n.method||"GET";if(Ve.has(i.toUpperCase()))throw new TypeError(`Failed to construct 'Request': '${i}' HTTP method is unsupported.`);Ge.has(i.toUpperCase())&&(i=i.toUpperCase());let c=r.body!=null?r.body:te(e)&&e.body!==null?M(e):null;if(c!=null&&(i==="GET"||i==="HEAD"))throw new TypeError("Request with GET/HEAD method cannot have body");super(c,{size:r.size||n.size||0});let s=n,l=new d(r.headers||s.headers||{});if(c!==null&&!l.has("Content-Type")){let p=I(this);p&&l.append("Content-Type",p)}let a="signal"in r?r.signal:te(s)?s.signal:null;if(a!=null&&!ae(a))throw new TypeError("Expected signal to be an instanceof AbortSignal or EventTarget");if(!a){let p=typeof AbortController<"u"?AbortController:_e;a=new p().signal}this[g]={method:i,redirect:r.redirect||s.redirect||"follow",headers:l,credentials:r.credentials||"same-origin",parsedURL:o,signal:a||null},this.keepalive,this.follow=r.follow===void 0?s.follow===void 0?20:s.follow:r.follow,this.compress=r.compress===void 0?s.compress===void 0?!0:s.compress:r.compress,this.counter=r.counter||s.counter||0,this.agent=r.agent||s.agent,this.highWaterMark=r.highWaterMark||s.highWaterMark||16384,this.insecureHTTPParser=r.insecureHTTPParser||s.insecureHTTPParser||!1}get cache(){return"default"}get credentials(){return this[g].credentials}get destination(){return""}get integrity(){return""}get mode(){return"cors"}get referrer(){return""}get referrerPolicy(){return""}get method(){return this[g].method}get url(){return We(this[g].parsedURL)}get headers(){return this[g].headers}get redirect(){return this[g].redirect}get signal(){return this[g].signal}clone(){return new w(this)}get[Symbol.toStringTag](){return"Request"}};Object.defineProperties(w.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}});var xe=t=>{let{parsedURL:e}=t[g],r=new d(t[g].headers);r.has("Accept")||r.set("Accept","*/*");let o=null;if(t.body===null&&/^(post|put)$/i.test(t.method)&&(o="0"),t.body!==null){let s=ge(t);typeof s=="number"&&!Number.isNaN(s)&&(o=String(s))}o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch"),t.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate,br");let{agent:n}=t;typeof n=="function"&&(n=n(e)),!r.has("Connection")&&!n&&r.set("Connection","close");let i=Te(e);return{path:e.pathname+i,pathname:e.pathname,hostname:e.hostname,protocol:e.protocol,port:e.port,hash:e.hash,search:e.search,query:e.query,href:e.href,method:t.method,headers:r[Symbol.for("nodejs.util.inspect.custom")](),insecureHTTPParser:t.insecureHTTPParser,agent:n}};var V=class extends T{constructor(e,r="aborted"){super(e,r)}};import{pipeline as v,PassThrough as Ee}from"node:stream";import*as Le from"node:stream";var Qe=new Set(["data:","http:","https:","file:"]);async function re(t,e={}){return new Promise((r,o)=>{let n=new w(t,e),i=xe(n);if(!Qe.has(i.protocol))throw new TypeError(`node-fetch cannot load ${t}. URL scheme "${i.protocol.replace(/:$/,"")}" is not supported.`);if(i.protocol==="data:"){let u=Je(n.url.toString()),y=new h(u,{headers:{"Content-Type":u.typeFull}});r(y);return}if(i.protocol==="file:"){let u=Ze.createReadStream(new URL(n.url)),y=Re.lookup(n.url)||"application/octet-stream",f=new h(u,{headers:{"Content-Type":y}});r(f);return}let c=(i.protocol==="https:"?Ye:Ke).request,{signal:s}=n,l=null,a=null,p=()=>{let u=new V("The operation was aborted.");o(u),n.body&&n.body.cancel(u),a&&a.emit("error",u)};if(s&&s.aborted){p();return}let E=()=>{p(),A()},R=c(i);s&&s.addEventListener("abort",E);let A=()=>{R.abort(),s&&s.removeEventListener("abort",E)};R.on("error",u=>{o(new m(`request to ${n.url} failed, reason: ${u.message}`,"system",u)),A()}),Xe(R,u=>{s&&s.aborted||a?.emit("error",u)}),parseInt(process.version.substring(1))<14&&R.on("socket",u=>{u.prependListener("close",y=>{let f=u.listenerCount("data")>0;if(l&&f&&!y&&!(s&&s.aborted)){let L=Object.assign(new Error("Premature close"),{code:"ERR_STREAM_PREMATURE_CLOSE"});a?.emit("error",L)}})}),R.on("response",u=>{a=u,R.setTimeout(0);let y=Se(a.rawHeaders);if(_(Number(a.statusCode))){let G=y.get("Location"),z=G===null?null:new URL(G,n.url);switch(n.redirect){case"error":o(new m(`uri requested responds with a redirect, redirect mode is set to error: ${n.url}`,"no-redirect")),A();return;case"manual":z!==null&&y.set("Location",z.toString());break;case"follow":{if(z===null)break;if(n.counter>=n.follow){o(new m(`maximum redirect reached at: ${n.url}`,"max-redirect")),A();return}let P={headers:new d(n.headers),follow:n.follow,counter:n.counter+1,agent:n.agent,compress:n.compress,method:n.method,body:e.body,signal:s,size:n.size},Ae=P.body instanceof C||P.body instanceof Le.Readable;if(a.statusCode!==303&&Ae){o(new m("Cannot follow redirect with body being a readable stream","unsupported-redirect")),A();return}(a.statusCode===303||(a.statusCode===301||a.statusCode===302)&&n.method==="POST")&&(P.method="GET",P.body=void 0,P.headers.delete("content-length")),re(new w(z.href,P)).then(r,o),A();return}default:return o(new TypeError(`Redirect option '${n.redirect}' is not a valid value of RequestRedirect`))}}s&&a.once("end",()=>{s.removeEventListener("abort",E)});let f=v(a,new Ee,o);process.version<"v12.10"&&a.on("aborted",E);let L={url:n.url,status:a.statusCode,statusText:a.statusMessage,headers:y,size:n.size,counter:n.counter,highWaterMark:n.highWaterMark},B=y.get("Content-Encoding");if(!n.compress||n.method==="HEAD"||B===null||a.statusCode===204||a.statusCode===304){l=new h(f,L),r(l);return}let Ce={flush:k.Z_SYNC_FLUSH,finishFlush:k.Z_SYNC_FLUSH};if(B==="gzip"||B==="x-gzip"){f=v(f,k.createGunzip(Ce),o),l=new h(F(f),L),r(l);return}if(B==="deflate"||B==="x-deflate"){v(a,new Ee,o).once("data",z=>{(z[0]&15)===8?f=v(f,k.createInflate(),o):f=v(f,k.createInflateRaw(),o),l=new h(F(f),L),r(l)});return}if(B==="br"){f=v(f,k.createBrotliDecompress(),o),l=new h(F(f),L),r(l);return}l=new h(F(f),L),r(l)}),we(R,n)})}function Xe(t,e){let r=Buffer.from(`0\r
\r
`),o=!1,n=!1,i;t.on("response",c=>{let{headers:s}=c;o=s["transfer-encoding"]==="chunked"&&!s["content-length"]}),t.on("socket",c=>{let s=()=>{if(o&&!n){let a=Object.assign(new Error("Premature close"),{code:"ERR_STREAM_PREMATURE_CLOSE"});e(a)}},l=a=>{n=Buffer.compare(a.slice(-5),r)===0,!n&&i&&(n=Buffer.compare(i.slice(-3),r.slice(0,3))===0&&Buffer.compare(a.slice(-2),r.slice(3))===0),i=a};c.prependListener("close",s),c.on("data",l),t.on("close",()=>{c.removeListener("close",s),c.removeListener("data",l)})})}var je=re;export{N as Blob,D as FormData,d as Headers,C as ReadableStream,w as Request,h as Response,je as default,re as fetch};
//# sourceMappingURL=web-fetch.mjs.map