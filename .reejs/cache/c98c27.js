/* esm.sh - esbuild bundle(surrealdb.js@0.5.0) deno production */
var H=0;function h(){return(H=(H+1)%Number.MAX_SAFE_INTEGER).toString()}var $=class extends Error{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"AuthenticationError"})}},D=class extends Error{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PermissionError"})}},I=class extends Error{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RecordError"})}},k={AuthenticationError:$,PermissionError:D,RecordError:I};var p=function(s,t,r,e){if(r==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!e:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?e:r==="a"?e.call(s):e?e.value:t.get(s)},f,y=class{constructor(){f.set(this,{})}on(t,r){typeof p(this,f,"f")[t]!="object"&&(p(this,f,"f")[t]=[]),p(this,f,"f")[t].push(r)}off(t,r){if(typeof p(this,f,"f")[t]=="object"){let e=p(this,f,"f")[t].indexOf(r);e>-1&&p(this,f,"f")[t].splice(e,1)}}once(t,r){this.on(t,function e(...i){this.off(t,e),r.apply(this,i)})}emit(t,...r){typeof p(this,f,"f")[t]=="object"&&p(this,f,"f")[t].forEach(e=>{e.apply(this,r)})}removeAllListeners(t){if(t)typeof p(this,f,"f")[t]=="object"&&(p(this,f,"f")[t]=[]);else for(let r in p(this,f,"f"))p(this,f,"f")[r]=[]}};f=new WeakMap;var T=function(s,t,r,e,i){if(e==="m")throw new TypeError("Private method is not writable");if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e==="a"?i.call(s,r):i?i.value=r:t.set(s,r),r},_=function(s,t,r,e){if(r==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!e:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?e:r==="a"?e.call(s):e?e.value:t.get(s)},E,P,j,C,A=class extends y{constructor(t,r,e){super(),E.set(this,void 0),P.set(this,void 0),j.set(this,void 0),C.set(this,void 0),T(this,P,t,"f"),T(this,j,r,"f"),T(this,C,e,"f"),_(this,P,"f").ready&&this.open(),_(this,P,"f").on("opened",()=>{this.open()}),_(this,P,"f").on("closed",()=>{T(this,E,void 0,"f")}),_(this,P,"f").on("notify",i=>{if(i.query===_(this,E,"f"))switch(i.action){case"CREATE":return this.emit("create",i.result);case"UPDATE":return this.emit("update",i.result);case"DELETE":return this.emit("delete",i.result)}})}kill(){if(_(this,E,"f")===void 0)return;let t=_(this,P,"f").kill(_(this,E,"f"));return T(this,E,void 0,"f"),t}open(){if(_(this,E,"f")===void 0)return _(this,P,"f").query(_(this,j,"f"),_(this,C,"f")).then(t=>{t[0]&&Array.isArray(t[0].result)&&t[0].result[0]&&T(this,E,t[0].result[0],"f")})}};E=new WeakMap,P=new WeakMap,j=new WeakMap,C=new WeakMap;import{default as K}from"./952dee.js";var c=function(s,t,r,e){if(r==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!e:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?e:r==="a"?e.call(s):e?e.value:t.get(s)},x=function(s,t,r,e,i){if(e==="m")throw new TypeError("Private method is not writable");if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e==="a"?i.call(s,r):i?i.value=r:t.set(s,r),r},G,d,O,R,F,J,Q=Symbol("Opened"),V=Symbol("Closed"),W=class extends y{constructor(t){super(),G.add(this),d.set(this,void 0),O.set(this,void 0),R.set(this,!1),F.set(this,V),Object.defineProperty(this,"ready",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resolve",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),c(this,G,"m",J).call(this),x(this,O,String(t).replace("http://","ws://").replace("https://","wss://"),"f")}open(){x(this,d,new K(c(this,O,"f")),"f"),c(this,d,"f").addEventListener("message",t=>{this.emit("message",t)}),c(this,d,"f").addEventListener("error",t=>{this.emit("error",t)}),c(this,d,"f").addEventListener("close",t=>{this.emit("close",t)}),c(this,d,"f").addEventListener("open",t=>{this.emit("open",t)}),c(this,d,"f").addEventListener("close",()=>{c(this,F,"f")===Q&&c(this,G,"m",J).call(this)}),c(this,d,"f").addEventListener("close",()=>{x(this,F,V,"f")}),c(this,d,"f").addEventListener("open",()=>{x(this,F,Q,"f")}),c(this,d,"f").addEventListener("close",()=>{c(this,R,"f")===!1&&setTimeout(()=>{this.open()},2500)}),c(this,d,"f").addEventListener("open",()=>{this.resolve()})}send(t){c(this,d,"f").send(t)}close(t=1e3,r="Some reason"){x(this,R,!0,"f"),c(this,d,"f").close(t,r)}};d=new WeakMap,O=new WeakMap,R=new WeakMap,F=new WeakMap,G=new WeakSet,J=function(){this.ready=new Promise(t=>{this.resolve=t})};var Y=function(s,t,r,e,i){if(e==="m")throw new TypeError("Private method is not writable");if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e==="a"?i.call(s,r):i?i.value=r:t.set(s,r),r},Z=function(s,t,r,e){if(r==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!e:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?e:r==="a"?e.call(s):e?e.value:t.get(s)},q,N,L=class{constructor(t=3e4){q.set(this,void 0),N.set(this,void 0),Y(this,N,t,"f")}start(t,...r){Y(this,q,setInterval(t,Z(this,N,"f"),...r),"f")}stop(){clearInterval(Z(this,q,"f"))}};q=new WeakMap,N=new WeakMap;var g=function(s,t,r,e,i){if(e==="m")throw new TypeError("Private method is not writable");if(e==="a"&&!i)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?s!==t||!i:!t.has(s))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e==="a"?i.call(s,r):i?i.value=r:t.set(s,r),r},n=function(s,t,r,e){if(r==="a"&&!e)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?s!==t||!e:!t.has(s))throw new TypeError("Cannot read private member from an object whose class did not declare it");return r==="m"?e:r==="a"?e.call(s):e?e.value:t.get(s)},o,u,z,v,M,U,tt,l,B,et,rt,b,S,X,w=class extends y{constructor(t,r){super(),o.add(this),u.set(this,void 0),z.set(this,void 0),v.set(this,void 0),M.set(this,void 0),U.set(this,void 0),g(this,z,t,"f"),g(this,v,r,"f"),t&&this.connect(t)}static get Instance(){return X||(X=new w)}static get AuthenticationError(){return k.AuthenticationError}static get PermissionError(){return k.PermissionError}static get RecordError(){return k.RecordError}static get Live(){return A}get token(){return n(this,v,"f")}set token(t){g(this,v,t,"f")}connect(t){return g(this,u,new W(t),"f"),g(this,M,new L(3e4),"f"),n(this,u,"f").on("open",()=>{n(this,o,"m",tt).call(this)}),n(this,u,"f").on("open",()=>{this.emit("open"),this.emit("opened"),n(this,M,"f").start(()=>{this.ping()})}),n(this,u,"f").on("close",()=>{this.emit("close"),this.emit("closed"),n(this,M,"f").stop()}),n(this,u,"f").on("message",r=>{let e=JSON.parse(r.data);if(e.method!=="notify")return this.emit(e.id,e);if(e.method==="notify")return e.params.forEach(i=>{this.emit("notify",i)})}),n(this,u,"f").open(),this.wait()}sync(t,r){return new A(this,t,r)}wait(){return n(this,u,"f").ready.then(()=>n(this,U,"f"))}close(){n(this,u,"f").close()}ping(){let t=h();return n(this,u,"f").ready.then(()=>new Promise(()=>{n(this,o,"m",l).call(this,t,"ping")}))}use(t,r){let e=h();return n(this,u,"f").ready.then(()=>new Promise((i,a)=>{this.once(e,m=>n(this,o,"m",b).call(this,m,i,a)),n(this,o,"m",l).call(this,e,"use",[t,r])}))}info(){let t=h();return n(this,u,"f").ready.then(()=>new Promise((r,e)=>{this.once(t,i=>n(this,o,"m",b).call(this,i,r,e)),n(this,o,"m",l).call(this,t,"info")}))}signup(t){let r=h();return n(this,u,"f").ready.then(()=>new Promise((e,i)=>{this.once(r,a=>n(this,o,"m",rt).call(this,a,e,i)),n(this,o,"m",l).call(this,r,"signup",[t])}))}signin(t){let r=h();return n(this,u,"f").ready.then(()=>new Promise((e,i)=>{this.once(r,a=>n(this,o,"m",et).call(this,a,e,i)),n(this,o,"m",l).call(this,r,"signin",[t])}))}invalidate(){let t=h();return n(this,u,"f").ready.then(()=>new Promise((r,e)=>{this.once(t,i=>n(this,o,"m",B).call(this,i,r,e)),n(this,o,"m",l).call(this,t,"invalidate")}))}authenticate(t){let r=h();return n(this,u,"f").ready.then(()=>new Promise((e,i)=>{this.once(r,a=>n(this,o,"m",B).call(this,a,e,i)),n(this,o,"m",l).call(this,r,"authenticate",[t])}))}live(t){let r=h();return this.wait().then(()=>new Promise((e,i)=>{this.once(r,a=>n(this,o,"m",b).call(this,a,e,i)),n(this,o,"m",l).call(this,r,"live",[t])}))}kill(t){let r=h();return this.wait().then(()=>new Promise((e,i)=>{this.once(r,a=>n(this,o,"m",b).call(this,a,e,i)),n(this,o,"m",l).call(this,r,"kill",[t])}))}let(t,r){let e=h();return this.wait().then(()=>new Promise((i,a)=>{this.once(e,m=>n(this,o,"m",b).call(this,m,i,a)),n(this,o,"m",l).call(this,e,"let",[t,r])}))}query(t,r){let e=h();return this.wait().then(()=>new Promise((i,a)=>{this.once(e,m=>n(this,o,"m",b).call(this,m,i,a)),n(this,o,"m",l).call(this,e,"query",[t,r])}))}select(t){let r=h();return this.wait().then(()=>new Promise((e,i)=>{this.once(r,a=>n(this,o,"m",S).call(this,a,"select",t,e,i)),n(this,o,"m",l).call(this,r,"select",[t])}))}create(t,r){let e=h();return this.wait().then(()=>new Promise((i,a)=>{this.once(e,m=>n(this,o,"m",S).call(this,m,"create",t,i,a)),n(this,o,"m",l).call(this,e,"create",[t,r])}))}update(t,r){let e=h();return this.wait().then(()=>new Promise((i,a)=>{this.once(e,m=>n(this,o,"m",S).call(this,m,"update",t,i,a)),n(this,o,"m",l).call(this,e,"update",[t,r])}))}change(t,r){let e=h();return this.wait().then(()=>new Promise((i,a)=>{this.once(e,m=>n(this,o,"m",S).call(this,m,"change",t,i,a)),n(this,o,"m",l).call(this,e,"change",[t,r])}))}modify(t,r){let e=h();return this.wait().then(()=>new Promise((i,a)=>{this.once(e,m=>n(this,o,"m",S).call(this,m,"modify",t,i,a)),n(this,o,"m",l).call(this,e,"modify",[t,r])}))}delete(t){let r=h();return this.wait().then(()=>new Promise((e,i)=>{this.once(r,a=>n(this,o,"m",S).call(this,a,"delete",t,e,i)),n(this,o,"m",l).call(this,r,"delete",[t])}))}};u=new WeakMap,z=new WeakMap,v=new WeakMap,M=new WeakMap,U=new WeakMap,o=new WeakSet,tt=function(){g(this,U,new Promise(t=>{n(this,v,"f")?this.authenticate(n(this,v,"f")).then(t).catch(t):t()}),"f")},l=function(t,r,e=[]){n(this,u,"f").send(JSON.stringify({id:t,method:r,params:e}))},B=function(t,r,e){return t.error?e(new w.AuthenticationError(t.error.message)):r(t.result)},et=function(t,r,e){return t.error?e(new w.AuthenticationError(t.error.message)):(g(this,v,t.result,"f"),r(t.result))},rt=function(t,r,e){if(t.error)return e(new w.AuthenticationError(t.error.message));if(t.result)return g(this,v,t.result,"f"),r(t.result)},b=function(t,r,e){return t.error?e(new Error(t.error.message)):t.result?r(t.result):r(void 0)},S=function(t,r,e,i,a){if(t.error)return a(new Error(t.error.message));if(t.result)switch(r){case"delete":return i(void 0);case"create":return Array.isArray(t.result)&&t.result.length?i(t.result[0]):a(new w.PermissionError(`Unable to create record: ${e}`));case"update":return typeof e=="string"&&e.includes(":")?Array.isArray(t.result)&&t.result.length?i(t.result[0]):a(new w.PermissionError(`Unable to update record: ${e}`)):i(t.result);case"change":return typeof e=="string"&&e.includes(":")?Array.isArray(t.result)&&t.result.length?i(t.result[0]):a(new w.PermissionError(`Unable to update record: ${e}`)):i(t.result);case"modify":return typeof e=="string"&&e.includes(":")?Array.isArray(t.result)&&t.result.length?i(t.result[0]):a(new w.PermissionError(`Unable to update record: ${e}`)):i(t.result);default:return typeof e=="string"&&e.includes(":")?Array.isArray(t.result)&&t.result.length?i(t.result):a(new w.RecordError(`Record not found: ${e}`)):i(t.result)}return i(void 0)};export{w as default};
//# sourceMappingURL=surrealdb.bundle.mjs.map